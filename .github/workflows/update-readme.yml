name: Update Deep Thought of the Day

on:
  schedule:
    # Runs at 00:00 UTC daily
    - cron: '0 0 * * *'
  workflow_dispatch:  # Allows manual trigger

jobs:
  update-readme:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Update README with thought of the day
        run: |
          # Get day of year (1-365/366) to select which thought to display
          DAY_OF_YEAR=$(date +%j)
          
          # Remove leading zeros from day of year
          DAY_OF_YEAR=$((10#$DAY_OF_YEAR))
          
          # Count total number of thoughts
          TOTAL_THOUGHTS=$(wc -l < thoughts.txt)
          
          # Calculate which thought to use (cycle through if needed)
          THOUGHT_INDEX=$(( (DAY_OF_YEAR - 1) % TOTAL_THOUGHTS + 1 ))
          
          # Get the thought for today
          THOUGHT_LINE=$(sed -n "${THOUGHT_INDEX}p" thoughts.txt)
          
          # Split into quote and author
          THOUGHT=$(echo "$THOUGHT_LINE" | cut -d'|' -f1)
          AUTHOR=$(echo "$THOUGHT_LINE" | cut -d'|' -f2)
          
          # Create typing text with author attribution
          TYPING_TEXT="$THOUGHT - $AUTHOR"
          
          # Truncate if too long (max ~80 chars for typing SVG)
          if [ ${#TYPING_TEXT} -gt 80 ]; then
            TYPING_TEXT="${TYPING_TEXT:0:77}..."
          fi
          
          # URL encode the thought for the typing SVG
          ENCODED_THOUGHT=$(echo "$TYPING_TEXT" | sed 's/ /+/g' | sed 's/,/%2C/g' | sed 's/;/%3B/g' | sed "s/'/%27/g" | sed 's/"/%22/g' | sed 's/\./%2E/g' | sed 's/-/%2D/g')
          
          # Get current date in a nice format (e.g., "November 5th")
          DAY=$(date '+%d' | sed 's/^0//')
          MONTH=$(date '+%B')
          
          # Add proper suffix (st, nd, rd, th)
          case $DAY in
            1|21|31) SUFFIX="st";;
            2|22) SUFFIX="nd";;
            3|23) SUFFIX="rd";;
            *) SUFFIX="th";;
          esac
          
          DATE_STRING="$MONTH ${DAY}${SUFFIX}"
          
          # Create the new README
          cat > README.md << 'EOF'
          ## ðŸ§  Deep Thought for ${DATE_STRING}
          
          ![Typing SVG](https://readme-typing-svg.demolab.com?font=IBM+Plex+Mono&pause=400&color=00FF00&vCenter=true&width=800&lines=${ENCODED_THOUGHT})
          EOF
          
          # Replace the placeholders with actual values
          sed -i "s|\${ENCODED_THOUGHT}|$ENCODED_THOUGHT|" README.md
          sed -i "s/\${DATE_STRING}/$DATE_STRING/" README.md
      
      - name: Commit and push if changed
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add README.md
          git diff --quiet && git diff --staged --quiet || (git commit -m "Update deep thought for $(date '+%B %d, %Y')" && git push)
